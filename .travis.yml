language: node_js
node_js: node
dist: xenial
os: linux
services:
  -  docker

cache: 
  directories:
    - dist

before_script:
  - npm install -g sass

stages:
  - build
  - deploy

jobs: 
  include:
    - stage: build
      name: "Compile SASS"
      script: sass ./Code/:./dist

    - stage: build
      name: "Copy files"
      script: 
        - cp ./Code/*.html ./dist
        - cp -r ./Code/assets/* ./dist/assets/*

    - stage: deploy
      name: "Build and Push Docker image"
      script: 
        - echo Building image
        - docker build -t appdustry/website .
        - echo Pushing image
        - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
        - docker push appdustry/website